<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE reports SYSTEM "../reports.dtd" >
<reports>

  <report id="Relationship Report">
	<description>
		Lists different types of personnel relationships
	</description>
	
	<reportparameters>
		<reportparameter name="param_source"></reportparameter>
		<reportparameter name="param_extract_name"></reportparameter>
		<reportparameter name="param_extract_description"></reportparameter>
		<reportparameter name="param_relationship_types"></reportparameter>
		<reportparameter name="param_chkActivePartners"></reportparameter>
		<reportparameter name="param_chkExcludeNoSolicitations"></reportparameter>
		<reportparameter name="param_chkMailingAddressesOnly"></reportparameter>
		<reportparameter name="param_use_reciprocal_relationship"></reportparameter>
	</reportparameters>
		
	<reportheader></reportheader>

	<pageheader>
		<field whichfield="title1"><value text="Relationship Report"></value></field>
		<field whichfield="title2"><value function="getSiteName()"></value></field>
		<field whichfield="descr1">
			<fielddetail>
				<value text="Selected Relationships: "></value>
				<value variable="param_relationship_types"></value>
			</fielddetail>
			<fielddetail condition="eq({param_use_reciprocal_relationship}, true)">
				<value text=" (Reciprocal)"/>
			</fielddetail>
		</field>

		<field whichfield="period2">
			<fielddetail>
				<value text="Selection: "></value>
			</fielddetail>
			<fielddetail condition="eq({param_selection}, one partner)">
				<value text="Partner: "></value><value variable="param_partnerkey"></value>
			</fielddetail>
			<fielddetail condition="eq({param_selection}, an extract)">
				<value text="Extract: "></value><value variable="param_extract"></value>
			</fielddetail>
			<fielddetail condition="eq({param_selection}, all current staff)">
				<value text="All Staff at "></value>
				<value variable="param_currentstaffdate"></value>
			</fielddetail>
		</field>
	</pageheader>

    <calculations>
	
	<calculation id="Select Relationships Reciprocal" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_partner_relationship.p_relation_name_c AS Relationship,
						PUB_p_partner_relationship.p_partner_key_n AS Rel1PartnerKey,
						PUB_p_partner_relationship.p_relation_key_n AS Rel2PartnerKey,
						Rel1.p_partner_short_name_c AS Rel1PartnerName,
						Rel2.p_partner_short_name_c AS Rel2PartnerName,
						Rel1.p_partner_class_c AS Rel1PartnerClass,
						Rel2.p_partner_class_c AS Rel2PartnerClass
					FROM
						PUB_p_partner_relationship,
						PUB_p_partner AS Rel1,
						PUB_p_partner AS Rel2
				</value>
			</queryDetail>
			<queryDetail condition="eq({param_selection}, one partner)">
				<value>
					WHERE 
						PUB_p_partner_relationship.p_relation_key_n = {{param_partnerkey}}
				</value>
			</queryDetail>
			<queryDetail condition="eq({param_selection}, an extract)">
				<value>
						, PUB_m_extract,
						PUB_m_extract_master
					WHERE 
						PUB_m_extract.p_partner_key_n = PUB_p_partner_relationship.p_relation_key_n
						AND PUB_m_extract.m_extract_id_i = PUB_m_extract_master.m_extract_id_i
						AND PUB_m_extract_master.m_extract_name_c = {param_extract}
				</value>
			</queryDetail>
			<queryDetail condition="eq({param_selection}, all current staff)">
				<value>
						, PUB_pm_staff_data
					WHERE 
						PUB_pm_staff_data.p_partner_key_n = PUB_p_partner_relationship.p_relation_key_n
						AND PUB_pm_staff_data.pm_start_of_commitment_d &lt;= {#param_currentstaffdate#}
						AND ( PUB_pm_staff_data.pm_end_of_commitment_d &gt;= {#param_currentstaffdate#}
							OR PUB.pm_staff_data.pm_end_of_commitment_d IS NULL )
				</value>
			</queryDetail>
			
			<queryDetail condition="eq({param_chkActivePartners}, true)">
				<value>
					AND  Rel2.p_status_code_c = "ACTIVE" 
				</value>
			</queryDetail>
			
			<queryDetail condition="eq({param_chkExcludeNoSolicitations}, true)">
				<value>
					AND Rel2.p_no_solicitations_l = 0
				</value>
			</queryDetail>
			<queryDetail>
				<value>
						AND PUB_p_partner_relationship.p_partner_key_n &lt;&gt; 0
						AND PUB_p_partner_relationship.p_relation_key_n &lt;&gt; 0
						AND Rel1.p_partner_key_n = PUB_p_partner_relationship.p_partner_key_n
						AND Rel2.p_partner_key_n = PUB_p_partner_relationship.p_relation_key_n
						AND
				</value>
			</queryDetail>
			<queryDetail>
				<value function="csv" text="PUB_p_partner_relationship.p_relation_name_c" variable="param_relationship_types" calculation="OR">
				</value>
			</queryDetail>
			<queryDetail>
				<value>
						ORDER BY PUB_p_partner_relationship.p_relation_key_n
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Relationships Direct" returns="automatic" returnsFormat="row">
		<query>	
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_partner_relationship.p_relation_name_c AS Relationship,
						PUB_p_partner_relationship.p_partner_key_n AS Rel1PartnerKey,
						PUB_p_partner_relationship.p_relation_key_n AS Rel2PartnerKey,
						Rel1.p_partner_short_name_c AS Rel1PartnerName,
						Rel2.p_partner_short_name_c AS Rel2PartnerName,
						Rel1.p_partner_class_c AS Rel1PartnerClass,
						Rel2.p_partner_class_c AS Rel2PartnerClass
					FROM
						PUB_p_partner_relationship,
						PUB_p_partner AS Rel1,
						PUB_p_partner AS Rel2
				</value>
			</queryDetail>
			<queryDetail condition="eq({param_selection}, one partner)">
				<value>
					WHERE 
						PUB_p_partner_relationship.p_partner_key_n = {{param_partnerkey}}
				</value>
			</queryDetail>
			<queryDetail condition="eq({param_selection}, an extract)">
				<value>
						, PUB_m_extract,
						PUB_m_extract_master
					WHERE 
						PUB_m_extract.p_partner_key_n = PUB_p_partner_relationship.p_partner_key_n
						AND PUB_m_extract.m_extract_id_i = PUB_m_extract_master.m_extract_id_i
						AND PUB_m_extract_master.m_extract_name_c = {param_extract}
				</value>
			</queryDetail>
			<queryDetail condition="eq({param_selection}, all current staff)">
				<value>
						, PUB_pm_staff_data
					WHERE 
						PUB_pm_staff_data.p_partner_key_n = PUB_p_partner_relationship.p_partner_key_n
						AND PUB_pm_staff_data.pm_start_of_commitment_d &lt;= {#param_currentstaffdate#}
						AND ( PUB_pm_staff_data.pm_end_of_commitment_d &gt;= {#param_currentstaffdate#}
							OR PUB.pm_staff_data.pm_end_of_commitment_d IS NULL )
				</value>
			</queryDetail>
			<queryDetail condition="eq({param_chkActivePartners}, true)">
				<value>
					AND  Rel1.p_status_code_c = "ACTIVE" 
				</value>
			</queryDetail>
			<queryDetail condition="eq({param_chkExcludeNoSolicitations}, true)">
				<value>
					AND Rel1.p_no_solicitations_l = 0
				</value>
			</queryDetail>
			<queryDetail>
				<value>
						AND PUB_p_partner_relationship.p_partner_key_n &lt;&gt; 0
						AND PUB_p_partner_relationship.p_relation_key_n &lt;&gt; 0
						AND Rel1.p_partner_key_n = PUB_p_partner_relationship.p_partner_key_n
						AND Rel2.p_partner_key_n = PUB_p_partner_relationship.p_relation_key_n
						AND
				</value>
			</queryDetail>
			<queryDetail>
				<value function="csv" text="PUB_p_partner_relationship.p_relation_name_c" variable="param_relationship_types" calculation="OR">
				</value>
			</queryDetail>
			<queryDetail>
				<value>
						ORDER BY PUB_p_partner_relationship.p_partner_key_n
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Church Details Rel1" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_church.p_church_name_c,
						PUB_p_church.p_contact_partner_key_n AS Rel11ContactPartnerKey,
						PUB_p_partner.p_partner_short_name_c AS Rel11ContactPerson
					FROM
						PUB_p_church,
						PUB_p_partner
					WHERE
							PUB_p_church.p_partner_key_n = {Rel1PartnerKey}
						AND PUB_p_partner.p_partner_key_n = PUB_p_church.p_contact_partner_key_n
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Church Details Rel2" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_church.p_church_name_c,
						PUB_p_church.p_contact_partner_key_n AS Rel22ContactPartnerKey,
						PUB_p_partner.p_partner_short_name_c AS Rel22ContactPerson
					FROM
						PUB_p_church,
						PUB_p_partner
					WHERE
							PUB_p_church.p_partner_key_n = {Rel2PartnerKey}
						AND PUB_p_partner.p_partner_key_n = PUB_p_church.p_contact_partner_key_n
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Family Details Rel1" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_family.p_first_name_c AS Rel11FirstName,
						PUB_p_family.p_family_name_c AS Rel11FamilyName,
						PUB_p_family.p_title_c AS Rel11Title
					FROM
						PUB_p_family
					WHERE
						PUB_p_family.p_partner_key_n = {Rel1PartnerKey}
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Family Details Rel2" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_family.p_first_name_c AS Rel22FirstName,
						PUB_p_family.p_family_name_c AS Rel22FamilyName,
						PUB_p_family.p_title_c AS Rel22Title
					FROM
						PUB_p_family
					WHERE
						PUB_p_family.p_partner_key_n = {Rel2PartnerKey}
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Person Details Rel1" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_person.p_first_name_c AS Rel11FirstName,
						PUB_p_person.p_family_name_c AS Rel11FamilyName,
						PUB_p_person.p_title_c AS Rel11Title,
						PUB_p_person.p_prefered_name_c AS Rel11PreferedName,
						PUB_p_person.p_date_of_birth_d AS Rel11DateOfBirth
					FROM
						PUB_p_person
					WHERE
						PUB_p_person.p_partner_key_n = {Rel1PartnerKey}
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Person Details Rel2" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_person.p_first_name_c AS Rel22FirstName,
						PUB_p_person.p_family_name_c AS Rel22FamilyName,
						PUB_p_person.p_title_c AS Rel22Title,
						PUB_p_person.p_prefered_name_c AS Rel22PreferedName,
						PUB_p_person.p_date_of_birth_d AS Rel22DateOfBirth
					FROM
						PUB_p_person
					WHERE
						PUB_p_person.p_partner_key_n = {Rel2PartnerKey}
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Organisation Details Rel1" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_organisation.p_organisation_name_c,
						PUB_p_organisation.p_contact_partner_key_n AS Rel11ContactPartnerKey,
						PUB_p_partner.p_partner_short_name_c AS Rel11ContactPerson
					FROM
						PUB_p_organisation,
						PUB_p_partner
					WHERE
							PUB_p_organisation.p_partner_key_n = {Rel1PartnerKey}
						AND PUB_p_partner.p_partner_key_n = PUB_p_organisation.p_contact_partner_key_n
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Organisation Details Rel2" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_organisation.p_organisation_name_c,
						PUB_p_organisation.p_contact_partner_key_n AS Rel22ContactPartnerKey,
						PUB_p_partner.p_partner_short_name_c AS Rel22ContactPerson
					FROM
						PUB_p_organisation,
						PUB_p_partner
					WHERE
							PUB_p_organisation.p_partner_key_n = {Rel2PartnerKey}
						AND PUB_p_partner.p_partner_key_n = PUB_p_organisation.p_contact_partner_key_n
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Unit Details Rel1" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_unit.p_unit_name_c AS Rel11ContactPerson
					FROM
						PUB_p_unit
					WHERE
						PUB_p_unit.p_partner_key_n = {Rel1PartnerKey}
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Select Unit Details Rel2" returns="automatic" returnsFormat="row">
		<query>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_unit.p_unit_name_c AS Rel22ContactPerson
					FROM
						PUB_p_unit
					WHERE
						PUB_p_unit.p_partner_key_n = {Rel2PartnerKey}
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation id="Make Addresses" returns="automatic" returnsFormat="text">
		<query>
			<queryDetail>
				<value text="NO-SQL"/>
				<value function="GetPartnerBestAddress({Rel1PartnerKey})"/>
				<!-- move the values to the Partner 1 Addresses -->
				<value function="assign(Rel1Telephone, concatenate({TelephoneNumber},{Extension}))"/>
				<value function="assign(Rel1Locality, {Locality})"/>
				<value function="assign(Rel1Address3, {Address3})"/>
				<value function="assign(Rel1City, {City})"/>
				<value function="assign(Rel1CountryCode, {CountryCode})"/>
				<value function="assign(Rel1County, {County})"/>
				<value function="assign(Rel1EmailAddress, {EmailAddress})"/>
				<value function="assign(Rel1PostalCode, {PostalCode})"/>
				<value function="assign(Rel1StreetName, {StreetName})"/>
				
				<!-- Hide rows when "mailing address only" is checked and we don't have a mailing address -->
				<value function ="ConditionRow(not(and(and(eq({param_chkMailingAddressesOnly}, true), not({SendMail})), eq({param_use_reciprocal_relationship}, false)))"/>
				
				<!-- Get best address of partner 2 -->
				<value function="GetPartnerBestAddress({Rel2PartnerKey})"/>
				<value function="assign(Telephone, concatenate({TelephoneNumber},{Extension}))"/>
				
				<!-- Hide rows when "mailing address only" is checked and we don't have a mailing address -->
				<value function ="ConditionRow(not(and(and(eq({param_chkMailingAddressesOnly}, true), not({SendMail})), eq({param_use_reciprocal_relationship}, true))))"/>
			</queryDetail>
			<!-- TODO: ORGANIZATION SPECIFIC  p_type_code_c -->
			<!-- Get the OM er field if partner is a person or family -->
			<queryDetail condition="or(eq({Rel1PartnerClass}, PERSON), eq({Rel1PartnerClass}, FAMILY))">
				<value function="assign(Rel1OMField, GetFieldOfPartner({Rel1PartnerKey}))"/>
			</queryDetail>
			<queryDetail condition="or(eq({Rel2PartnerClass}, PERSON), eq({Rel2PartnerClass}, FAMILY))">
				<value function="assign(Rel2WorkerField, GetFieldOfPartner({Rel2PartnerKey}))"/>
			</queryDetail>
			
			<!-- Assign specific values depending on the partner type -->
			<queryDetail condition="eq({Rel1PartnerClass}, PERSON)" >
				<value function="assign(Rel1DateOfBirth, {Rel11DateOfBirth})" />
				<value function="assign(Rel1PreferedName, {Rel11PreferedName})" />
				<value function="assign(Rel1FirstName, {Rel11FirstName})" />
				<value function="assign(Rel1FamilyName, {Rel11FamilyName})" />
				<value function="assign(Rel1Title, {Rel11Title})" />
			</queryDetail>
			<queryDetail condition="eq({Rel2PartnerClass}, PERSON)" >
				<value function="assign(Rel2DateOfBirth, {Rel22DateOfBirth})" />
				<value function="assign(Rel2PreferedName, {Rel22PreferedName})" />
				<value function="assign(Rel2FirstName, {Rel22FirstName})" />
				<value function="assign(Rel2FamilyName, {Rel22FamilyName})" />
				<value function="assign(Rel2Title, {Rel22Title})" />
			</queryDetail>
			<queryDetail condition="eq({Rel1PartnerClass}, FAMILY)" >
				<value function="assign(Rel1FirstName, {Rel11FirstName})" />
				<value function="assign(Rel1FamilyName, {Rel11FamilyName})" />
				<value function="assign(Rel1Title, {Rel11Title})" />
			</queryDetail>
			<queryDetail condition="eq({Rel2PartnerClass}, FAMILY)" >
				<value function="assign(Rel2FirstName, {Rel22FirstName})" />
				<value function="assign(Rel2FamilyName, {Rel22FamilyName})" />
				<value function="assign(Rel2Title, {Rel22Title})" />
			</queryDetail>
			<queryDetail condition="or(eq({Rel1PartnerClass}, CHURCH), eq({Rel1PartnerClass}, ORGANISATION))" >
				<value function="assign(Rel1ContactPartnerKey, {Rel11ContactPartnerKey})" />
				<value function="assign(Rel1ContactPerson, {Rel11ContactPerson})" />
			</queryDetail>
			<queryDetail condition="or(eq({Rel2PartnerClass}, CHURCH), eq({Rel2PartnerClass}, ORGANISATION))" >
				<value function="assign(Rel2ContactPartnerKey, {Rel22ContactPartnerKey})" />
				<value function="assign(Rel2ContactPerson, {Rel22ContactPerson})" />
			</queryDetail>
			<queryDetail condition="eq({Rel1PartnerClass}, UNIT)" >
				<value function="assign(Rel1ContactPerson, {Rel11ContactPerson})" />
			</queryDetail>
			<queryDetail condition="eq({Rel2PartnerClass}, UNIT)" >
				<value function="assign(Rel2ContactPerson, {Rel22ContactPerson})" />
			</queryDetail>
		</query>
	</calculation>
	
	<!-- Here we clear all values, so we can define some of them in "Make Addresses" -->
	<!-- This is necessary because if we have in row 1 a person and show "date of birth", and we have in row 2 a family
		(which doesn't have "date of birth", the "date of birth" value is wrongly taken over from row 1 to row 2 -->
	<calculation id="ClearValues" returns="automatic" returnsFormat="text">
		<query>
			<queryDetail>
				<value text="NO-SQL"/>
				<value function="assign(Rel1DateOfBirth, )" />
				<value function="assign(Rel1PreferedName, )" />
				<value function="assign(Rel1FirstName, )" />
				<value function="assign(Rel1FamilyName, )" />
				<value function="assign(Rel1Title, )" />
				<value function="assign(Rel1ContactPartnerKey, )" />
				<value function="assign(Rel1ContactPerson, )" />
				<value function="assign(Rel2DateOfBirth, )" />
				<value function="assign(Rel2PreferedName, )" />
				<value function="assign(Rel2FirstName, )" />
				<value function="assign(Rel2FamilyName, )" />
				<value function="assign(Rel2Title, )" />
				<value function="assign(Rel2ContactPartnerKey, )" />
				<value function="assign(Rel2ContactPerson, )" />
			</queryDetail>
			<queryDetail>
				<value>
					SELECT DISTINCT
						PUB_p_partner.p_partner_key_n
					FROM
						PUB_p_partner
					WHERE
						PUB_p_partner.p_partner_key_n = {Rel1PartnerKey}
				</value>
			</queryDetail>
		</query>
	</calculation>
	
	<!-- values from table p_partner_relationship -->
	<calculation align="left" id="Partner 1 Partner Key" returns="text" returnsFormat="partnerkey">
		<caption><value text="P1 Partner Key"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1PartnerKey"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Partner Key" returns="text" returnsFormat="partnerkey">
		<caption><value text="P2 Partner Key"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2PartnerKey"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Relationship" returns="text" returnsFormat="text">
		<caption><value text="Relationship"></value></caption>
		<query>
			<queryDetail>
				<value variable="Relationship"></value>
			</queryDetail>
		</query>
	</calculation>
	<!-- values from table p_partner_relationship -->
	
	<!-- Address Values  Partner 1-->
	<calculation align="left" id="Partner 1 Address Line 1" returns="text" returnsFormat="text">
		<caption><value text="P1 Address Line 1"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1Locality"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Address Line 3" returns="text" returnsFormat="text">
		<caption><value text="P1 Address Line 3"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1Address3"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Address City" returns="text" returnsFormat="text">
		<caption><value text="P1 City"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1City"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Address Country" returns="text" returnsFormat="text">
		<caption><value text="P1 Country"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1CountryCode"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Address State / County / Province" returns="text" returnsFormat="text">
		<caption><value text="P1 State / County"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1County"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Address E-Mail" returns="text" returnsFormat="text">
		<caption><value text="P1 Email"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1EmailAddress"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Address Post Code" returns="text" returnsFormat="text">
		<caption><value text="P1 Post Code"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1PostalCode"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Address Street" returns="text" returnsFormat="text">
		<caption><value text="P1 Street"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1StreetName"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Address Telephone" returns="text" returnsFormat="text">
		<caption><value text="P1 Telephone"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1Telephone"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Address Mobile" returns="text" returnsFormat="text">
		<caption><value text="P1 Mobile"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1Mobile"></value>
			</queryDetail>
		</query>
	</calculation>
	<!-- End of Address Values Partner 1 -->
	
	
	<!-- Address Values  Partner 2-->
	<calculation align="left" id="Partner 2 Address Line 1" returns="text" returnsFormat="text">
		<caption><value text="P2 Address Line 2"></value></caption>
		<query>
			<queryDetail>
				<value variable="Locality"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Address Line 3" returns="text" returnsFormat="text">
		<caption><value text="P2 Address Line 3"></value></caption>
		<query>
			<queryDetail>
				<value variable="Address3"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Address City" returns="text" returnsFormat="text">
		<caption><value text="P2 City"></value></caption>
		<query>
			<queryDetail>
				<value variable="City"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Address Country" returns="text" returnsFormat="text">
		<caption><value text="P2 Country"></value></caption>
		<query>
			<queryDetail>
				<value variable="CountryCode"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Address State / County / Province" returns="text" returnsFormat="text">
		<caption><value text="P2 State / County"></value></caption>
		<query>
			<queryDetail>
				<value variable="County"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Address E-Mail" returns="text" returnsFormat="text">
		<caption><value text="P2 Email"></value></caption>
		<query>
			<queryDetail>
				<value variable="EmailAddress"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Address Post Code" returns="text" returnsFormat="text">
		<caption><value text="P2 Post Code"></value></caption>
		<query>
			<queryDetail>
				<value variable="PostalCode"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Address Street" returns="text" returnsFormat="text">
		<caption><value text="P2 Street"></value></caption>
		<query>
			<queryDetail>
				<value variable="StreetName"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Address Telephone" returns="text" returnsFormat="text">
		<caption><value text="P2 Telephone"></value></caption>
		<query>
			<queryDetail>
				<value variable="Telephone"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Address Mobile" returns="text" returnsFormat="text">
		<caption><value text="P2 Mobile"></value></caption>
		<query>
			<queryDetail>
				<value variable="MobileNumber"></value>
			</queryDetail>
		</query>
	</calculation>
	<!-- End of Address Values Partner 2 -->
	
	<!-- Specific values for different partner classes  Partner 1-->
	<calculation align="left" id="Partner 1 Partner Name" returns="text" returnsFormat="text">
		<caption><value text="P1 PartnerName"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1PartnerName"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Partner Class" returns="text" returnsFormat="text">
		<caption><value text="P1 PartnerClass"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1PartnerClass"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Prefered Name" returns="text" returnsFormat="text">
		<caption><value text="P1 Prefered Name"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1PreferedName"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 First Name" returns="text" returnsFormat="text">
		<caption><value text="P1 Ffirst Name"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1FirstName"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Family Name" returns="text" returnsFormat="text">
		<caption><value text="P1 Family Name"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1FamilyName"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Title" returns="text" returnsFormat="text">
		<caption><value text="P1 Title"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1Title"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Date Of Birth" returns="text" returnsFormat="formatteddate">
		<caption><value text="P1 Date Of Birth"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1DateOfBirth"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Contact Person" returns="text" returnsFormat="text">
		<caption><value text="P1 Contact Person"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1ContactPerson"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Contact Partner Key" returns="text" returnsFormat="partnerkey">
		<caption><value text="P1 Contact PartnerKey"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1ContactPartnerKey"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 1 Worker Field" returns="text" returnsFormat="text">
		<caption><value text="P1 Worker Field"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel1WorkerField"></value>
			</queryDetail>
		</query>
	</calculation>
	<!-- End of specific values Partner 1 -->
	
	<!-- Specific values for different partner classes  Partner 2-->
	<calculation align="left" id="Partner 2 Partner Name" returns="text" returnsFormat="text">
		<caption><value text="P2 PartnerName"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2PartnerName"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Partner Class" returns="text" returnsFormat="text">
		<caption><value text="P2 PartnerClass"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2PartnerClass"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Prefered Name" returns="text" returnsFormat="text">
		<caption><value text="P2 Prefered Name"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2PreferedName"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 First Name" returns="text" returnsFormat="text">
		<caption><value text="P2 Ffirst Name"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2FirstName"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Family Name" returns="text" returnsFormat="text">
		<caption><value text="P2 Family Name"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2FamilyName"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Title" returns="text" returnsFormat="text">
		<caption><value text="P2 Title"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2Title"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Date Of Birth" returns="text" returnsFormat="formatteddate">
		<caption><value text="P2 Date Of Birth"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2DateOfBirth"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Contact Person" returns="text" returnsFormat="text">
		<caption><value text="P2 Contact Person"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2ContactPerson"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Contact Partner Key" returns="text" returnsFormat="partnerkey">
		<caption><value text="P2 Contact PartnerKey"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2ContactPartnerKey"></value>
			</queryDetail>
		</query>
	</calculation>
	
	<calculation align="left" id="Partner 2 Worker Field" returns="text" returnsFormat="text">
		<caption><value text="P2 Worker Field"></value></caption>
		<query>
			<queryDetail>
				<value variable="Rel2WorkerField"></value>
			</queryDetail>
		</query>
	</calculation>
	<!-- End of specific values Partner 2 -->
	
    </calculations>
    
    <levels> 
	<level name="main">
		<detail>
			<switch>
				<case condition="eq({param_use_reciprocal_relationship}, true)">
					<lowerLevelReport calculation="Select Relationships Reciprocal" level="Partner Pair 11 Level"></lowerLevelReport>
				</case>
				<default>
					<lowerLevelReport calculation="Select Relationships Direct" level="Partner Pair 11 Level"></lowerLevelReport>
				</default>
			</switch>
		</detail>
	</level> 
	
	<level name="Partner Pair 11 Level" identification="Rel1PartnerKey">
		<detail>
			<lowerLevelReport calculation="ClearValues" level="Partner Pair 1 Level" />
		</detail>
	</level>
	
	<level name="Partner Pair 1 Level" identification="Rel1PartnerKey">
		<detail>
			<switch>
				<case condition="eq({Rel1PartnerClass}, CHURCH)">
					<lowerLevelReport calculation="Select Church Details Rel1" level="Partner Pair 2 Level"></lowerLevelReport>
				</case>
				<case condition="eq({Rel1PartnerClass}, PERSON)">
					<lowerLevelReport calculation="Select Person Details Rel1" level="Partner Pair 2 Level"></lowerLevelReport>
				</case>
				<case condition="eq({Rel1PartnerClass}, FAMILY)">
					<lowerLevelReport calculation="Select Family Details Rel1" level="Partner Pair 2 Level"></lowerLevelReport>
				</case>
				<case condition="eq({Rel1PartnerClass}, ORGANISATION)">
					<lowerLevelReport calculation="Select Organisation Details Rel1" level="Partner Pair 2 Level"></lowerLevelReport>
				</case>
				<case condition="eq({Rel1PartnerClass}, UNIT)">
					<lowerLevelReport calculation="Select Unit Details Rel1" level="Partner Pair 2 Level"></lowerLevelReport>
				</case>
				<default>
					<field whichfield="columns" calculation="Make Addresses"/>
				</default>
			</switch>
		</detail>
	</level>
	
	<level name="Partner Pair 2 Level" identification="Rel1PartnerKey">
		<detail>
			<switch>
				<case condition="eq({Rel2PartnerClass}, CHURCH)">
					<lowerLevelReport calculation="Select Church Details Rel2" level="Partner Details Level"></lowerLevelReport>
				</case>
				<case condition="eq({Rel2PartnerClass}, PERSON)">
					<lowerLevelReport calculation="Select Person Details Rel2" level="Partner Details Level"></lowerLevelReport>
				</case>
				<case condition="eq({Rel2PartnerClass}, FAMILY)">
					<lowerLevelReport calculation="Select Family Details Rel2" level="Partner Details Level"></lowerLevelReport>
				</case>
				<case condition="eq({Rel2PartnerClass}, ORGANISATION)">
					<lowerLevelReport calculation="Select Organisation Details Rel2" level="Partner Details Level"></lowerLevelReport>
				</case>
				<case condition="eq({Rel2PartnerClass}, UNIT)">
					<lowerLevelReport calculation="Select Unit Details Rel2" level="Partner Details Level"></lowerLevelReport>
				</case>
				<default>
					<field whichfield="columns" calculation="Make Addresses"/>
				</default>
			</switch>
		</detail>
	</level>
	
	<level name="Partner Details Level" identification="Rel1PartnerKey">
		<detail>
			<field whichfield="columns" calculation="Make Addresses"/>
		</detail>
	</level>
	
    </levels>

  </report>
  
</reports>
